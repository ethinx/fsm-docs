---
title: "Data plane benchmarking"
description: "Benchmarking FSM and fsm data planes"
type: docs
weight: 1
draft: false
---

FSM aims to provide service mesh functionality along with high performance resources, so that resource-constrained edge environments can also use the service mesh functionality used in the cloud.

In this test, benchmarks were conducted for **FSM (v1.1.4)** and **Istio (v1.19.3)**. The main focus is on service latency distribution when using two different meshes, and monitoring the resource overhead of the data plane.

FSM uses Pipy as the data plane and the Istio uses Envoy.

**Before testing, we clarify the focus on comparison latency and resource consumption between them, instead of the extreme performance.**

## Testing Environment

The benchmark was tested in a Kubernetes cluster running on Azure Cloud VM. There are 2 standard *Standard_D8_v3* nodes in the cluster. FSM and Istio are both **on loose traffic mode and mTLS, and the other settings are default**.

* Kubernetes: K3s v1.24.17+k3s1
* OS: Ubuntu 20.04
* Nodes: 8c32g * 2
* Sidecar: 1c512Mi

The test tool is on the branch `fsm` of [this repository](https://github.com/addozhang/istio-tools) which forked from [istio/tools](https://github.com/istio/tools).

## Procedure

The procedure was marked down in [this doc](https://github.com/addozhang/istio-tools/blob/fsm/perf/benchmark/fsm/README.md).

In test tool, there are two applications: fortioclient and fortioserver. The load is generated by fortioclient by triggered with `kubectl exec`.

For both mesh, we proceed the test for baseline (no sidecar) and both (two sidecars) modes. And generate load with 2, 4, 8, 16, 32, 64 concurrencies on QPS 1000. You can check the benchmark configs of [FSM](https://github.com/addozhang/istio-tools/blob/fsm/perf/benchmark/configs/fsm/fsm_latency.yaml) and [Istio](https://github.com/addozhang/istio-tools/blob/fsm/perf/benchmark/configs/istio/istio_latency.yaml).

The most important is setting [the request and limit resource](https://github.com/addozhang/istio-tools/blob/fsm/perf/benchmark/values.yaml#L9) on `1000m` and `512Mi`.

## Latency

### P50

![](https://github.com/addozhang/istio-tools/assets/2224492/ac37b7a7-bd39-408a-905c-304f4b71a607)

### P90

![](https://github.com/addozhang/istio-tools/assets/2224492/640251a9-adac-40a9-8fa4-1732baef6939)

### P99

![](https://github.com/addozhang/istio-tools/assets/2224492/a7a48403-6013-485a-8177-a5877df80f0c)

### P999

![](https://github.com/addozhang/istio-tools/assets/2224492/5c5eee13-aeba-4755-9617-a3985156964b)

## Resource Consumption

### Client sidecar cpu

![](https://github.com/addozhang/istio-tools/assets/2224492/27454bd5-899b-4cc2-ae91-80c23e89024c)

### Server sidecar cpu

![](https://github.com/addozhang/istio-tools/assets/2224492/875486b8-c7f0-416d-8b63-dc2f82ce30fa)

### Client sidecar memory

![](https://github.com/addozhang/istio-tools/assets/2224492/66d2fbd8-8e83-4374-ba09-467dc88516c3)

### Server sidecar memory

![](https://github.com/addozhang/istio-tools/assets/2224492/69067968-e0de-40df-8ce2-c37b26b76d38)

## Summary

This time, we benchmarked FSM and Istio data planes with limited sidecar resources. 

- Latency: The latency of FSM's Pipy sidecar proxy is lower than Istio's Envoy, especially under high concurrency.
- Resource consumption: With only 2 services, FSM's Pipy consumes less resources than Istio's Envoy.

From the results, FSM can still maintain high performance with low resource usage and more efficient use of resources. So FSM is particularly suitable for resource-constrained and large-scale scenarios,  reduces costs effectively. These are made possible by [Pipy](https://flomesh.io/pipy)'s low-resource, high-performance features.

Of course, FSM is suitable for cloud, it can be applied to the edge computing scenarios.